<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Audio Sample Generator ‚Äî Bilingual (VI/EN)</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:#0f1724;color:#e6eef8;padding:20px}
    .card{background:#0b1220;border-radius:12px;padding:18px;max-width:1000px;margin:12px auto;box-shadow:0 6px 24px rgba(2,6,23,.6)}
    label{display:block;margin-top:10px;font-size:14px;cursor:help}
    label:hover{color:#58a6ff}
    input[type=range]{width:100%}
    .row{display:flex;gap:12px;align-items:center}
    .col{flex:1}
    button{background:#1f6feb;border:none;padding:10px 14px;border-radius:8px;color:white;cursor:pointer;margin-top:10px;transition:background .2s}
    button:hover{background:#2a7fff}
    button.secondary{background:#334155}
    button.secondary:hover{background:#475569}
    .footer{font-size:13px;color:#9fb0c9;margin-top:8px}
    .controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
    input[type=number]{width:100%;padding:6px;border-radius:6px;border:1px solid #253341;background:#08101a;color:#e6eef8}
    select{padding:6px;border-radius:6px;border:1px solid #253341;background:#08101a;color:#e6eef8;cursor:pointer}
    .lang{float:right}
    .info-icon{display:inline-block;margin-left:6px;color:#58a6ff;cursor:help;font-size:12px}
    .tooltip-box{position:relative;display:inline-block}
    .tooltip-box:hover .tooltip-text{visibility:visible;opacity:1}
    .tooltip-text{visibility:hidden;opacity:0;position:absolute;z-index:1;background:#1c2938;color:#e6eef8;padding:8px 12px;border-radius:6px;font-size:12px;line-height:1.4;width:280px;bottom:125%;left:50%;margin-left:-140px;transition:opacity .3s;box-shadow:0 4px 12px rgba(0,0,0,.4);border:1px solid #334155}
    .tooltip-text::after{content:"";position:absolute;top:100%;left:50%;margin-left:-5px;border-width:5px;border-style:solid;border-color:#1c2938 transparent transparent transparent}
  </style>
</head>
<body>
  <div class="card">
    <div style="display:flex;align-items:center;justify-content:space-between">
      <h2 id="title">Audio Sample Generator</h2>
      <div class="lang">
        <label for="langsel" style="font-size:13px;margin-right:8px;margin-top:0" id="langlabel">Ng√¥n ng·ªØ</label>
        <select id="langsel" aria-label="Select language">
          <option value="vi">Ti·∫øng Vi·ªát</option>
          <option value="en">English</option>
        </select>
      </div>
    </div>

    <p id="desc">T·∫°o v√† t·∫£i xu·ªëng test tone (sine/square/triangle/saw) ho·∫∑c noise. C√≥ s·∫µn preset <strong>35 Hz</strong>.</p>

    <div class="controls">
      <div>
        <label id="waveform_label" class="tooltip-box">
          D·∫°ng s√≥ng
          <span class="info-icon">‚ìò</span>
          <span class="tooltip-text" id="waveform_tooltip"></span>
        </label>
        <select id="waveform">
          <option value="sine" data-tooltip-vi="üéß Sine (Sin) ‚Äî M∆∞·ª£t nh·∫•t, s·∫°ch nh·∫•t. Ch·ªâ c√≥ 1 t·∫ßn s·ªë duy nh·∫•t (kh√¥ng c√≥ h√†i b·∫≠c cao). D√πng nhi·ªÅu nh·∫•t cho test loa/sub. √Çm thanh: '√ôuuuuuuuu' r·∫•t √™m, d·ªÖ nghe, kh√¥ng ch√≥i. ·ª®ng d·ª•ng: Test bass 20Hz, 30Hz, 40Hz; ƒëo ƒë√°p tuy·∫øn t·∫ßn s·ªë; ki·ªÉm tra ƒë·ªô m√©o (THD)." data-tooltip-en="üéß Sine (Sin) ‚Äî Smoothest, cleanest. Single frequency only (no harmonics). Mostly used for testing speakers/subs. Sound: '√ôuuuuuuuu', soft, easy to listen, not harsh. Applications: Bass test 20Hz, 30Hz, 40Hz; frequency response; THD check.">Sine (Sin)</option>

          <option value="square" data-tooltip-vi="üì¶ Square ‚Äî R·∫•t s·∫Øc, r·∫•t g·∫Øt. Xu·∫•t hi·ªán t·∫ßn s·ªë g·ªëc + c√°c h√†i b·∫≠c l·∫ª (3x, 5x, 7x...). √Çm thanh: ki·ªÉu 'b√≠p/b√≠p/b√≠p', nghe kh√° ch√≥i, ƒë√¥i khi kh√≥ ch·ªãu. ·ª®ng d·ª•ng: Test ph·∫£n h·ªìi t·ªëc ƒë·ªô driver; test loa treble; d√πng trong synth (nh·∫°c ƒëi·ªán t·ª≠ 8-bit)." data-tooltip-en="üì¶ Square ‚Äî Sharp, very 'edgy'. Contains fundamental + odd harmonics (3rd,5th,7th...). Sound: 'beep/beep/beep', quite harsh, sometimes annoying. Applications: Driver speed response; treble speaker test; used in synth (8-bit electronic music).">Square</option>

          <option value="triangle" data-tooltip-vi="üî∫ Triangle ‚Äî M·ªÅm h∆°n square. C√≥ h√†i b·∫≠c l·∫ª nh∆∞ng y·∫øu d·∫ßn nhanh. G·∫ßn gi·ªëng sine nh∆∞ng s·∫Øc h∆°n ch√∫t. √Çm thanh: gi·ªØa sine v√† square, v·∫´n h∆°i g·∫Øt nh∆∞ng kh√¥ng kh√≥ ch·ªãu. ·ª®ng d·ª•ng: Synth nh·∫°c; test h·ªá th·ªëng nh∆∞ng √≠t d√πng h∆°n sine." data-tooltip-en="üî∫ Triangle ‚Äî Softer than square. Contains odd harmonics but weaker. Close to sine but slightly sharper. Sound: between sine and square, slightly harsh but not annoying. Applications: Music synth; system test but less used than sine.">Triangle</option>

          <option value="sawtooth" data-tooltip-vi="üìà Saw/Sawtooth ‚Äî C√≥ m·ªçi b·∫≠c h√†i (r·∫•t gi√†u harmonic). Nghe ƒë·∫ßy v√† cƒÉng. √Çm thanh: ki·ªÉu ti·∫øng xe tƒÉng ho·∫∑c synth lead, d·ªÖ g√¢y m√©o n·∫øu loa/tai kh√¥ng t·ªët. ·ª®ng d·ª•ng: Synth m·∫°nh (EDM, lead, bass); test kh·∫£ nƒÉng x·ª≠ l√Ω harmonic." data-tooltip-en="üìà Saw/Sawtooth ‚Äî Contains all harmonics (very rich). Full and tense sound. Sound: like tank or synth lead, may distort if speakers/headphones are poor. Applications: Powerful synth (EDM, lead, bass); harmonic processing test.">Sawtooth</option>

          <option value="noise" data-tooltip-vi="üîä Noise ‚Äî Nhi·ªÖu tr·∫Øng, d√πng ƒë·ªÉ test t·ªïng th·ªÉ. √Çm thanh: t·∫°p √¢m, d√πng ki·ªÉm tra ƒë√°p tuy·∫øn to√†n d·∫£i. ·ª®ng d·ª•ng: test h·ªá th·ªëng full-range, ƒëo ƒë√°p tuy·∫øn t·∫ßn s·ªë, ki·ªÉm tra thi·∫øt b·ªã." data-tooltip-en="üîä Noise ‚Äî White noise, used for overall system test. Sound: random noise, used for full-range response check. Applications: Full-range system test, frequency response measurement, device check.">Noise</option>
        </select>

        <label id="freq_label" class="tooltip-box">
          T·∫ßn s·ªë (Hz)
          <span class="info-icon">‚ìò</span>
          <span class="tooltip-text" id="freq_tooltip"></span>
        </label>
        <div style="display:flex;gap:10px;align-items:center">
          <input type="number" id="freq" value="35" min="1" max="20000" step="1" />
          <input type="range" id="freq_slider" value="35" min="1" max="20000" oninput="freq.value=this.value; updateFreqDisplay(this.value);" onchange="freq.value=this.value; updateFreqDisplay(this.value);" />
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center"><small id="freq_display">35 Hz</small></div>

        <label id="amp_label" class="tooltip-box">
          Bi√™n ƒë·ªô (0.0 - 1.0)
          <span class="info-icon">‚ìò</span>
          <span class="tooltip-text" id="amp_tooltip"></span>
        </label>
        <input type="number" step="0.01" id="amp" value="0.8" min="0" max="1" />

        <label id="dur_label" class="tooltip-box">
          ƒê·ªô d√†i (gi√¢y)
          <span class="info-icon">‚ìò</span>
          <span class="tooltip-text" id="dur_tooltip"></span>
        </label>
        <input type="number" id="duration" value="10" min="0.1" max="600" />
      </div>

      <div>
        <label id="sr_label" class="tooltip-box">
          T·∫ßn s·ªë m·∫´u (Hz)
          <span class="info-icon">‚ìò</span>
          <span class="tooltip-text" id="sr_tooltip"></span>
        </label>
        <select id="samplerate">
          <option value="8000" data-tooltip-vi="8 kHz ‚Äî Ch·∫•t l∆∞·ª£ng ƒëi·ªán tho·∫°i c∆° b·∫£n. Ch·ªâ ƒë·ªß cho gi·ªçng n√≥i ƒë∆°n gi·∫£n, √¢m thanh m·ªù v√† m√©o. Kh√¥ng d√πng cho √¢m nh·∫°c." data-tooltip-en="8 kHz ‚Äî Basic telephone quality. Only for simple voice, muffled and distorted sound. Not for music.">8 kHz</option>
          <option value="11025" data-tooltip-vi="11.025 kHz ‚Äî Legacy multimedia. D√πng cho game/multimedia c≈© (DOS era). Ch·∫•t l∆∞·ª£ng AM radio, kh√¥ng r√µ. Hi·∫øm khi d√πng ng√†y nay." data-tooltip-en="11.025 kHz ‚Äî Legacy multimedia. Used for old games/multimedia (DOS era). AM radio quality, unclear. Rarely used today.">11.025 kHz</option>
          <option value="16000" data-tooltip-vi="16 kHz ‚Äî VoIP, podcast ch·∫•t l∆∞·ª£ng th·∫•p. ƒê·ªß cho gi·ªçng n√≥i web. √Çm nh·∫°c s·∫Ω thi·∫øu treble v√† chi ti·∫øt. Ti·∫øt ki·ªám bƒÉng th√¥ng." data-tooltip-en="16 kHz ‚Äî VoIP, low-quality podcast. Sufficient for web voice. Music lacks treble and detail. Saves bandwidth.">16 kHz</option>
          <option value="22050" data-tooltip-vi="22.05 kHz ‚Äî Web audio c≈©. Ch·∫•t l∆∞·ª£ng FM radio c≈©. √Çm thanh ·ªïn cho gi·ªçng n√≥i, nh·∫°c h∆°i thi·∫øu. √çt d√πng hi·ªán nay." data-tooltip-en="22.05 kHz ‚Äî Old web audio. Old FM radio quality. Decent for voice, music slightly lacking. Less common now.">22.05 kHz</option>
          <option value="32000" data-tooltip-vi="32 kHz ‚Äî Video broadcast. D√πng cho DAT, NICAM TV audio. Ch·∫•t l∆∞·ª£ng t·ªët cho video, √≠t d√πng cho √¢m nh·∫°c thu·∫ßn. Chu·∫©n broadcast c≈©." data-tooltip-en="32 kHz ‚Äî Video broadcast. Used for DAT, NICAM TV audio. Good for video, less for pure music. Old broadcast standard.">32 kHz</option>
          <option value="44100" data-tooltip-vi="44.1 kHz ‚Äî CD Audio standard. Chu·∫©n CD √¢m nh·∫°c t·ª´ th·∫≠p ni√™n 1980. Ch·∫•t l∆∞·ª£ng t·ªët, ƒë·ªß cho tai ng∆∞·ªùi (20Hz-20kHz). Ph·ªï bi·∫øn nh·∫•t." data-tooltip-en="44.1 kHz ‚Äî CD Audio standard. Music CD standard since 1980s. Good quality, sufficient for human hearing (20Hz-20kHz). Most popular.">44.1 kHz</option>
          <option value="48000" selected data-tooltip-vi="48 kHz ‚≠ê ‚Äî Video/broadcast professional (khuy·∫øn ngh·ªã). Chu·∫©n video, film, broadcast, game. T·ªët h∆°n 44.1kHz ch√∫t, t∆∞∆°ng th√≠ch r·ªông. D√πng cho test loa/sub." data-tooltip-en="48 kHz ‚≠ê ‚Äî Video/broadcast professional (recommended). Standard for video, film, broadcast, games. Slightly better than 44.1kHz, widely compatible. Use for speaker/sub testing.">48 kHz ‚≠ê</option>
          <option value="88200" data-tooltip-vi="88.2 kHz ‚Äî Hi-Res (2x CD). G·∫•p ƒë√¥i 44.1kHz. D√πng mastering chuy√™n nghi·ªáp, chuy·ªÉn ƒë·ªïi xu·ªëng CD d·ªÖ. File l·ªõn g·∫•p ƒë√¥i. Tai ng∆∞·ªùi kh√≥ ph√¢n bi·ªát." data-tooltip-en="88.2 kHz ‚Äî Hi-Res (2x CD). Double 44.1kHz. Professional mastering, easy CD downsampling. File 2x larger. Hard for humans to distinguish.">88.2 kHz</option>
          <option value="96000" data-tooltip-vi="96 kHz ‚Äî Studio recording. Hi-Res audio, chu·∫©n studio cao c·∫•p. Chi ti·∫øt t·ªët h∆°n cho x·ª≠ l√Ω/mixing. File g·∫•p ƒë√¥i 48kHz. L·ª£i √≠ch th·ª±c t·∫ø c√≤n tranh c√£i." data-tooltip-en="96 kHz ‚Äî Studio recording. Hi-Res audio, high-end studio standard. Better detail for processing/mixing. File 2x 48kHz. Real benefits debated.">96 kHz</option>
          <option value="176400" data-tooltip-vi="176.4 kHz ‚Äî Hi-Res extreme (4x CD). G·∫•p 4 l·∫ßn CD. Ch·ªâ d√πng mastering c·ª±c k·ª≥ chuy√™n nghi·ªáp. File r·∫•t l·ªõn (4x). Tai ng∆∞·ªùi KH√îNG nghe ra kh√°c bi·ªát." data-tooltip-en="176.4 kHz ‚Äî Hi-Res extreme (4x CD). 4x CD rate. Only for extremely professional mastering. Very large files (4x). Humans CANNOT hear difference.">176.4 kHz</option>
          <option value="192000" data-tooltip-vi="192 kHz ‚Äî Mastering quality. Cao nh·∫•t cho audio consumer. Ch·ªâ cho mastering engineer chuy√™n s√¢u. File kh·ªïng l·ªì. L√£ng ph√≠ cho test loa th√¥ng th∆∞·ªùng." data-tooltip-en="192 kHz ‚Äî Mastering quality. Highest for consumer audio. Only for deep mastering engineers. Huge files. Wasteful for regular speaker testing.">192 kHz</option>
        </select>

        <label id="channels_label" class="tooltip-box">
          K√™nh
          <span class="info-icon">‚ìò</span>
          <span class="tooltip-text" id="channels_tooltip"></span>
        </label>
        <select id="channels">
          <option value="1">Mono</option>
          <option value="2">Stereo</option>
        </select>

        <label id="norm_label" class="tooltip-box">
          Chu·∫©n ho√° tr∆∞·ªõc khi xu·∫•t?
          <span class="info-icon">‚ìò</span>
          <span class="tooltip-text" id="norm_tooltip"></span>
        </label>
        <select id="normalize">
          <option value="true">Yes</option>
          <option value="false">No</option>
        </select>

        <div style="margin-top:10px">
          <button id="play" class="tooltip-box">
            Ph√°t
            <span class="tooltip-text" id="play_tooltip" style="margin-left:-140px"></span>
          </button>
          <button id="stop" class="secondary tooltip-box">
            D·ª´ng
            <span class="tooltip-text" id="stop_tooltip" style="margin-left:-140px"></span>
          </button>
        </div>
      </div>
    </div>

    <div style="margin-top:14px">
      <button id="download" class="tooltip-box">
        Render & T·∫£i xu·ªëng WAV
        <span class="tooltip-text" id="download_tooltip" style="margin-left:-140px"></span>
      </button>
      <button id="preset35" class="secondary tooltip-box">
        Preset: 35 Hz
        <span class="tooltip-text" id="preset35_tooltip" style="margin-left:-140px"></span>
      </button>
    </div>

    <div class="footer" id="footer">L∆∞u √Ω: tr√¨nh duy·ªát c√≥ th·ªÉ gi·ªõi h·∫°n √¢m l∆∞·ª£ng. D√πng file WAV ƒë·ªÉ test thi·∫øt b·ªã ch√≠nh x√°c h∆°n.</div>
  </div>

  <script>
    const strings = {
      vi: {
        title: 'Audio Sample Generator',
        desc: 'T·∫°o v√† t·∫£i xu·ªëng test tone (sine/square/triangle/saw) ho·∫∑c noise. C√≥ s·∫µn preset 35 Hz.',
        waveform_label: 'D·∫°ng s√≥ng',
        waveform_tooltip: 'VI: Ch·ªçn d·∫°ng s√≥ng √¢m thanh. Sine m∆∞·ª£t nh·∫•t, square s·∫Øc nh·∫•t, triangle trung b√¨nh, sawtooth gi√†u harmonic, noise d√πng cho test t·ªïng th·ªÉ.',
        freq_label: 'T·∫ßn s·ªë (Hz)',
        freq_tooltip: 'VI: ƒê·ªô cao/th·∫•p c·ªßa √¢m thanh. 20-60Hz: Bass s√¢u (sub), 60-250Hz: Bass trung, 250-2kHz: Midrange, 2k-8kHz: Treble, 8k-20kHz: Air/Sparkle. Con ng∆∞·ªùi nghe ƒë∆∞·ª£c 20Hz-20kHz.',
        amp_label: 'Bi√™n ƒë·ªô (0.0 - 1.0)',
        amp_tooltip: 'VI: √Çm l∆∞·ª£ng/ƒë·ªô to c·ªßa t√≠n hi·ªáu. 0.0 = im l·∫∑ng, 1.0 = t·ªëi ƒëa. Khuy·∫øn ngh·ªã 0.7-0.9 ƒë·ªÉ tr√°nh m√©o (clipping). Gi√° tr·ªã cao c√≥ th·ªÉ l√†m h∆∞ thi·∫øt b·ªã!',
        dur_label: 'ƒê·ªô d√†i (gi√¢y)',
        dur_tooltip: 'VI: Th·ªùi gian ph√°t √¢m thanh. Test nhanh: 5-10s. Test loa k·ªπ: 30-60s. Test ƒë·ªô b·ªÅn: 2-5 ph√∫t.',
        sr_label: 'T·∫ßn s·ªë m·∫´u (Hz)',
        sr_tooltip: 'VI: S·ªë l·∫ßn ghi √¢m thanh m·ªói gi√¢y. 44.1kHz: CD standard. 48kHz: Video/broadcast standard (khuy·∫øn ngh·ªã). 96kHz+: Hi-Res audio. Cao h∆°n = file l·ªõn h∆°n, chi ti·∫øt h∆°n.',
        channels_label: 'K√™nh',
        channels_tooltip: 'VI: Mono (1 k√™nh): test loa ƒë∆°n, sub, ho·∫∑c test k·ªπ thu·∫≠t. Stereo (2 k√™nh): test tai nghe, loa stereo, ho·∫∑c test soundstage.',
        norm_label: 'Chu·∫©n ho√° tr∆∞·ªõc khi xu·∫•t?',
        norm_tooltip: 'VI: T·ª± ƒë·ªông tƒÉng bi√™n ƒë·ªô l√™n m·ª©c t·ªëi ƒëa m√† kh√¥ng b·ªã m√©o khi xu·∫•t file. Yes: File WAV s·∫Ω to h∆°n. No: Gi·ªØ nguy√™n bi√™n ƒë·ªô ƒë√£ ch·ªçn. Khuy·∫øn ngh·ªã: Yes cho test, No cho d√πng chuy√™n nghi·ªáp.',
        play: 'Ph√°t',
        play_tooltip: 'VI: Ph√°t √¢m thanh tr·ª±c ti·∫øp tr√™n tr√¨nh duy·ªát. Ch√∫ √Ω: tr√¨nh duy·ªát c√≥ th·ªÉ h·∫°n ch·∫ø √¢m l∆∞·ª£ng ho·∫∑c t·∫ßn s·ªë th·∫•p. ƒê·ªÉ test ch√≠nh x√°c, d√πng n√∫t "Render & T·∫£i xu·ªëng WAV".',
        stop: 'D·ª´ng',
        stop_tooltip: 'VI: D·ª´ng ph√°t √¢m thanh ngay l·∫≠p t·ª©c.',
        download: 'Render & T·∫£i xu·ªëng WAV',
        download_tooltip: 'VI: T·∫°o file WAV ch·∫•t l∆∞·ª£ng cao ƒë·ªÉ test ch√≠nh x√°c tr√™n loa/tai nghe th·∫≠t. File WAV kh√¥ng b·ªã n√©n, gi·ªØ nguy√™n ch·∫•t l∆∞·ª£ng 100%.',
        preset35: 'Preset: 35 Hz',
        preset35_tooltip: 'VI: Nhanh ch√≥ng thi·∫øt l·∫≠p t·∫ßn s·ªë 35Hz (bass s√¢u) v·ªõi c√°c th√¥ng s·ªë t·ªëi ∆∞u: Sine wave, 0.9 amplitude, 10s, 48kHz, Mono. D√πng ƒë·ªÉ test subwoofer.',
        footer: 'L∆∞u √Ω: tr√¨nh duy·ªát c√≥ th·ªÉ gi·ªõi h·∫°n √¢m l∆∞·ª£ng. D√πng file WAV ƒë·ªÉ test thi·∫øt b·ªã ch√≠nh x√°c h∆°n.',
        langlabel: 'Ng√¥n ng·ªØ'
      },
      en: {
        title: 'Audio Sample Generator',
        desc: 'Generate and download test tones (sine/square/triangle/saw) or noise. Includes 35 Hz preset.',
        waveform_label: 'Waveform',
        waveform_tooltip: 'EN: Select audio waveform type. Sine is smoothest, square is sharpest, triangle is moderate, sawtooth is harmonically rich, noise for overall testing.',
        freq_label: 'Frequency (Hz)',
        freq_tooltip: 'EN: Pitch/tone height. 20-60Hz: Deep bass (sub), 60-250Hz: Mid-bass, 250-2kHz: Midrange, 2k-8kHz: Treble, 8k-20kHz: Air/Sparkle. Human hearing: 20Hz-20kHz.',
        amp_label: 'Amplitude (0.0 - 1.0)',
        amp_tooltip: 'EN: Volume/loudness of signal. 0.0 = silence, 1.0 = maximum. Recommended 0.7-0.9 to avoid clipping/distortion. High values may damage equipment!',
        dur_label: 'Duration (seconds)',
        dur_tooltip: 'EN: Playback time length. Quick test: 5-10s. Thorough speaker test: 30-60s. Endurance test: 2-5 minutes.',
        sr_label: 'Sample rate (Hz)',
        sr_tooltip: 'EN: Audio samples per second. 44.1kHz: CD standard. 48kHz: Video/broadcast standard (recommended). 96kHz+: Hi-Res audio. Higher = larger file, more detail.',
        channels_label: 'Channel',
        channels_tooltip: 'EN: Mono (1 channel): single speaker, sub, or technical testing. Stereo (2 channels): headphones, stereo speakers, or soundstage testing.',
        norm_label: 'Normalize before export?',
        norm_tooltip: 'EN: Automatically boosts audio to maximum amplitude without clipping when exporting. Yes: WAV file will be louder. No: Keeps chosen amplitude. Recommended: Yes for testing, No for professional use.',
        play: 'Play',
        play_tooltip: 'EN: Play audio directly in browser. Note: browsers may limit volume or low frequencies. For accurate testing, use "Render & Download WAV" button.',
        stop: 'Stop',
        stop_tooltip: 'EN: Stop audio playback immediately.',
        download: 'Render & Download WAV',
        download_tooltip: 'EN: Generate high-quality WAV file for accurate testing on real speakers/headphones. WAV is uncompressed, preserving 100% quality.',
        preset35: 'Preset: 35 Hz',
        preset35_tooltip: 'EN: Quickly set up 35Hz (deep bass) with optimal parameters: Sine wave, 0.9 amplitude, 10s, 48kHz, Mono. Use for subwoofer testing.',
        footer: 'Note: browsers may limit output volume. Use WAV for accurate device testing.',
        langlabel: 'Language'
      }
    };

    const langSel = document.getElementById('langsel');
    langSel.addEventListener('change', ()=>{ setLang(langSel.value); });

    function setLang(l){
      const s = strings[l];
      document.getElementById('title').innerText = s.title;
      document.getElementById('desc').innerHTML = s.desc;
      document.getElementById('waveform_label').childNodes[0].textContent = s.waveform_label + ' ';
      document.getElementById('waveform_tooltip').innerText = s.waveform_tooltip;
      document.getElementById('freq_label').childNodes[0].textContent = s.freq_label + ' ';
      document.getElementById('freq_tooltip').innerText = s.freq_tooltip;
      document.getElementById('amp_label').childNodes[0].textContent = s.amp_label + ' ';
      document.getElementById('amp_tooltip').innerText = s.amp_tooltip;
      document.getElementById('dur_label').childNodes[0].textContent = s.dur_label + ' ';
      document.getElementById('dur_tooltip').innerText = s.dur_tooltip;
      document.getElementById('sr_label').childNodes[0].textContent = s.sr_label + ' ';
      document.getElementById('sr_tooltip').innerText = s.sr_tooltip;
      document.getElementById('channels_label').childNodes[0].textContent = s.channels_label + ' ';
      document.getElementById('channels_tooltip').innerText = s.channels_tooltip;
      document.getElementById('norm_label').childNodes[0].textContent = s.norm_label + ' ';
      document.getElementById('norm_tooltip').innerText = s.norm_tooltip;
      document.getElementById('play').childNodes[0].textContent = s.play + ' ';
      document.getElementById('play_tooltip').innerText = s.play_tooltip;
      document.getElementById('stop').childNodes[0].textContent = s.stop + ' ';
      document.getElementById('stop_tooltip').innerText = s.stop_tooltip;
      document.getElementById('download').childNodes[0].textContent = s.download + ' ';
      document.getElementById('download_tooltip').innerText = s.download_tooltip;
      document.getElementById('preset35').childNodes[0].textContent = s.preset35 + ' ';
      document.getElementById('preset35_tooltip').innerText = s.preset35_tooltip;
      document.getElementById('footer').innerText = s.footer;
      document.getElementById('langlabel').innerText = s.langlabel;

      // update waveform tooltips
      const opts = document.querySelectorAll('#waveform option');
      opts.forEach(opt => {
        const vi = opt.getAttribute('data-tooltip-vi') || '';
        const en = opt.getAttribute('data-tooltip-en') || '';
        opt.title = (l==='vi') ? vi : en;
      });
      
      // update samplerate tooltips
      const srOpts = document.querySelectorAll('#samplerate option');
      srOpts.forEach(opt => {
        const vi = opt.getAttribute('data-tooltip-vi') || '';
        const en = opt.getAttribute('data-tooltip-en') || '';
        opt.title = (l==='vi') ? vi : en;
      });
    }

    setLang(langSel.value);

    // freq slider sync
    const freq = document.getElementById('freq');
    const freqSlider = document.getElementById('freq_slider');
    const freqDisplay = document.getElementById('freq_display');
    freq.addEventListener('input', ()=>{ freqSlider.value = freq.value; updateFreqDisplay(freq.value); });
    function updateFreqDisplay(v){ freqDisplay.innerText = Math.round(v*10)/10 + ' Hz'; }

    // play / stop / render logic
    let realtimeCtx, osc, gainNode, noiseSource; let playing = false;
    const waveformEl = document.getElementById('waveform');
    const ampEl = document.getElementById('amp');
    const durationEl = document.getElementById('duration');
    const srEl = document.getElementById('samplerate');
    const channelsEl = document.getElementById('channels');
    const normalizeEl = document.getElementById('normalize');

    function startRealtime() {
      if (playing) return;
      realtimeCtx = new (window.AudioContext || window.webkitAudioContext)();
      const wave = waveformEl.value;
      const gain = parseFloat(ampEl.value);
      const freqVal = parseFloat(freq.value);

      if (wave === 'noise') {
        const bufferSize = 2 * realtimeCtx.sampleRate;
        const noiseBuffer = realtimeCtx.createBuffer(1, bufferSize, realtimeCtx.sampleRate);
        const output = noiseBuffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) output[i] = (Math.random() * 2 - 1) * gain;
        noiseSource = realtimeCtx.createBufferSource();
        noiseSource.buffer = noiseBuffer;
        const loopGain = realtimeCtx.createGain();
        loopGain.gain.value = 1.0;
        noiseSource.connect(loopGain).connect(realtimeCtx.destination);
        noiseSource.loop = true;
        noiseSource.start();
      } else {
        osc = realtimeCtx.createOscillator();
        osc.type = wave;
        osc.frequency.value = freqVal;
        gainNode = realtimeCtx.createGain();
        gainNode.gain.value = gain;
        osc.connect(gainNode).connect(realtimeCtx.destination);
        osc.start();
      }
      playing = true;
    }

    function stopRealtime() {
      if (!playing) return;
      try {
        if (osc) { osc.stop(); osc.disconnect(); osc = null; }
        if (noiseSource) { noiseSource.stop(); noiseSource.disconnect(); noiseSource = null; }
        if (gainNode) { gainNode.disconnect(); gainNode = null; }
        if (realtimeCtx) { realtimeCtx.close(); realtimeCtx = null; }
      } catch(e){console.warn(e)}
      playing = false;
    }

    document.getElementById('play').addEventListener('click', startRealtime);
    document.getElementById('stop').addEventListener('click', stopRealtime);

    document.getElementById('preset35').addEventListener('click', ()=>{
      waveformEl.value = 'sine'; freq.value = '35'; freqSlider.value='35'; updateFreqDisplay(35); ampEl.value='0.9'; durationEl.value='10'; srEl.value='48000'; channelsEl.value='1';
    });

    document.getElementById('download').addEventListener('click', async ()=>{
      const wave = waveformEl.value;
      const freqVal = parseFloat(freq.value);
      const amp = parseFloat(ampEl.value);
      const duration = parseFloat(durationEl.value);
      const sampleRate = parseInt(srEl.value,10);
      const channels = parseInt(channelsEl.value,10);
      const doNormalize = normalizeEl.value === 'true';

      const totalSamples = Math.floor(sampleRate * duration);
      const buffers = [];
      for (let c=0;c<channels;c++) buffers.push(new Float32Array(totalSamples));
      for (let i=0;i<totalSamples;i++){
        const t = i / sampleRate;
        let v = 0;
        if (wave === 'noise') v = (Math.random()*2 -1) * amp;
        else {
          const phase = 2 * Math.PI * freqVal * t;
          switch(wave){
            case 'sine': v = Math.sin(phase) * amp; break;
            case 'square': v = (Math.sin(phase) >= 0 ? 1 : -1) * amp; break;
            case 'triangle': v = (2/Math.PI) * Math.asin(Math.sin(phase)) * amp; break;
            case 'sawtooth': v = (2/Math.PI) * (freqVal * Math.PI * (t % (1/freqVal)) - (Math.PI/2)) * amp; break;
            default: v = Math.sin(phase) * amp;
          }
        }
        for (let c=0;c<channels;c++) buffers[c][i] = v;
      }

      const fakeBuffer = { numberOfChannels: channels, length: totalSamples, sampleRate: sampleRate, getChannelData: (ch)=>buffers[ch] };
      const wavBlob = bufferToWavBlob(fakeBuffer, doNormalize);
      triggerDownload(wavBlob, `test-tone-${wave}-${freqVal}Hz-${duration}s.wav`);
    });

    function bufferToWavBlob(audioBuffer, normalize){
      const numChannels = audioBuffer.numberOfChannels;
      const sampleRate = audioBuffer.sampleRate;
      const length = audioBuffer.length;
      const samples = new Float32Array(length * numChannels);
      for (let ch=0; ch<numChannels; ch++){
        const data = audioBuffer.getChannelData(ch);
        for (let i=0;i<length;i++) samples[i * numChannels + ch] = data[i];
      }
      if (normalize){ let max = 0; for (let i=0;i<samples.length;i++){ const a = Math.abs(samples[i]); if (a>max) max=a; } if (max>0){ const norm = 1.0/max; for (let i=0;i<samples.length;i++) samples[i]*=norm; } }
      const buffer = new ArrayBuffer(44 + samples.length * 2);
      const view = new DataView(buffer);
      writeString(view, 0, 'RIFF'); view.setUint32(4, 36 + samples.length * 2, true); writeString(view, 8, 'WAVE'); writeString(view, 12, 'fmt '); view.setUint32(16, 16, true); view.setUint16(20, 1, true); view.setUint16(22, numChannels, true); view.setUint32(24, sampleRate, true); view.setUint32(28, sampleRate * numChannels * 2, true); view.setUint16(32, numChannels * 2, true); view.setUint16(34, 16, true); writeString(view, 36, 'data'); view.setUint32(40, samples.length * 2, true);
      let offset = 44; for (let i = 0; i < samples.length; i++, offset += 2) { let s = Math.max(-1, Math.min(1, samples[i])); view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true); }
      return new Blob([view], { type: 'audio/wav' });
      function writeString(view, offset, string) { for (let i = 0; i < string.length; i++) view.setUint8(offset + i, string.charCodeAt(i)); }
    }

    function triggerDownload(blob, filename){ const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.style.display='none'; a.href = url; a.download = filename; document.body.appendChild(a); a.click(); setTimeout(()=>{ document.body.removeChild(a); URL.revokeObjectURL(url); }, 1500); }

  </script>
</body>
</html>
